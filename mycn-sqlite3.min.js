"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var sqlite3=_interopDefault(require("sqlite3"));function toBasicDatabaseConnection(e){return{exec:async(t,n)=>toBasicExecResult(await e.run(t,n)),all:(t,n)=>e.all(t,n),prepare:async(t,n)=>toBasicPreparedStatement(await e.prepare(t,n)),execScript:async t=>{await e.exec(t)},close:async()=>{await e.close()}}}function toBasicExecResult(e){return{affectedRows:e.changes,insertedId:e.lastID}}function toBasicPreparedStatement(e){let t,n,a=!1;return{exec:async n=>(t=n,a=!1,toBasicExecResult(await e.run(n))),all:n=>(t=n,a=!1,e.all(n)),fetch:async()=>(n||(n=makeInMemoryCursor(await e.all(t))),n.fetch()),bind:async(e,n)=>{a?t||(t=[]):(a=!0,t=[]),t[e-1]=n},unbindAll:async()=>{a=!1,t=void 0},finalize:()=>e.finalize()}}function makeInMemoryCursor(e){let t=-1;return{fetch:()=>e[++t]}}async function createSqlite3Connection(e){let t;return await new Promise((n,a)=>{t=void 0!==e.mode?new sqlite3.Database(e.fileName,e.mode,e=>{e?a(e):n()}):new sqlite3.Database(e.fileName,e=>{e?a(e):n()})}),e.initCallback&&await e.initCallback(t),promisifyDatabase(t)}function promisifyDatabase(e){return{run:(t,n=[])=>new Promise((a,i)=>{e.run(t,n,function(e){e?i(e):a(this)})}),all:(t,n=[])=>new Promise((a,i)=>{e.all(t,n,(e,t)=>{e?i(e):a(t)})}),exec:t=>new Promise((n,a)=>{e.exec(t,e=>{e?a(e):n()})}),prepare:(t,n=[])=>{let a;return new Promise((i,r)=>{a=e.prepare(t,n,function(e){e?r(e):i()})}).then(()=>promisifyStatement(a))},close:()=>new Promise((t,n)=>{e.close(e=>{e?n(e):t()})})}}function promisifyStatement(e){return{run:(t=[])=>new Promise((n,a)=>{e.run(t,function(e){e?a(e):n(this)})}),all:(t=[])=>new Promise((n,a)=>{e.all(t,(e,t)=>{e?a(e):n(t)})}),finalize:()=>new Promise((t,n)=>{e.finalize(e=>{e?n(e):t()})})}}function sqlite3ConnectionProvider(e){return e.verbose&&sqlite3.verbose(),async()=>{return toBasicDatabaseConnection(await createSqlite3Connection(e))}}exports.sqlite3ConnectionProvider=sqlite3ConnectionProvider;